check {
  test_qsort_r.sh
  test_pthread.sh
  test_symbol.sh { CLOCK_MONOTONIC time.h IW_HAVE_CLOCK_MONOTONIC }
}

set {
  LDFLAG
  -lm
  if { defined { PTHREAD_LFLAG }
    ${PTHREAD_LFLAG}
  }
  if { defined { SYSTEM_ANDROID }
    -llog
  }
  ..${LDFLAG}
}

option { OWNER_PROJECT_NAME Optional name of the owner project used to install
                            header files into OWNER_PROJECT_NAME/META_PROJECT_NAME }

if { defined { OWNER_PROJECT_NAME }
  set {
    IW_PUBLIC_HEADER_DESTINATION ^{ ${INSTALL_INCLUDE_DIR} / ${OWNER_PROJECT_NAME} }
  }
} else {
  set {
    IW_PUBLIC_HEADER_DESTINATION ^{ ${INSTALL_INCLUDE_DIR} / ${META_NAME} }
  }
}

set {
  SOURCES
  iowow.c
}

set {
  PUB_HDRS
  basedefs.h
  iowow.h
}

configure {
  iwcfg.h.in
  libiowow.pc.in
}

include { fs/Autark }
include { json/Autark }
include { kv/Autark }
include { log/Autark }
include { platform/Autark }
include { rdb/Autark }
include { re/Autark }
include { utils/Autark }

cc {
  ${SOURCES}
  set { _ ${CFLAGS} -I SS{} }
  ${CC}
  consumes {
    iwcfg.h
  }
}


install { ${INSTALL_PKGCONFIG_DIR} libiowow.pc }
install { ${IW_PUBLIC_HEADER_DESTINATION} ${PUB_HDRS} }

echo { S= ${SOURCES} }
echo { H= ${PUB_HDRS} }